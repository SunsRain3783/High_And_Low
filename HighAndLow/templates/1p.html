{% load static %}
<!doctype HTML>
<html>
    <head>
        <link rel="stylesheet" href="{% static '1p.css' %}">
    </head>
    <body onload="firstFunc();"><!--ここから中身-->
    <!--ヘッダー-->
    <div class="header">
        <a href="/" class="btn-flat-vertical-border">トップページ</a>
        <a href="#" class="btn-flat-vertical-border2" style="left:85%;">遊び方</a>
    </div>
    
    <!--トランプの画像-->
    <div style="text-align: center">
        <img src="" width="270" class="bigcard" id="bigcard" />
    </div>
    <div style="text-align: center">
        <img src="" width="260" class="smallcard" id="smallcard" />
    </div>
    
    <!--ハイアンドローボタン-->
    <div class="highbtn">
        <a href="#" class="btn" id="high" onclick="changeDisplay1();" >▲ HIGH ▲</a>
        <a href="#" class="btn2" id="low" onclick="changeDisplay1();" >▼ LOW ▼</a>
    </div>
    
    <!--続けるやめるボタン-->
    <div class="stopcont">
        <font size="20"><a href="#" class="bt-stop" id="stop" onclick="changeDisplay2();" >続ける</a></font>
        <font size="20"><a href="#" class="bt-cont" id="cont" onclick="changeDisplay2();" >やめる</a></font>
    </div>
    <!--ベットやめるボタン-->
    <div class="bettop">
        <font size="10"><a href="#" class="btn-circle-border-double" id="bet" onclick="changeDisplay3();" >ベット</a></font>
        <font size="10"><a href="/" class="btn-circle-border-double2" id="top" >やめる</a></font>
    </div>
    
    <!--ベットボタン-->
    <div class="pickupblock">
        <img src="{% static 'betcoin.jpg' %}" width="1200" class="betcoin" id="betcoin" />
        <a href="#" class="btn-flat-bottom-border" id="betbtn" >
            <span>OK</span>
        </a>
    </div>

    <!-- モーダル部分 -->
    <div class="modaloverlay" id="modaloverlay_id">
    </div>
    
    </body>
</html>

<script>
//カードの配列(あえて１を最後にしている)
    var clover = ["{% static 'clover2.jpg' %}","{% static 'clover3.jpg' %}"
    ,"{% static 'clover4.jpg' %}","{% static 'clover5.jpg' %}","{% static 'clover6.jpg' %}","{% static 'clover7.jpg' %}"
    ,"{% static 'clover8.jpg' %}","{% static 'clover9.jpg' %}","{% static 'clover10.jpg' %}","{% static 'clover11.jpg' %}"
    ,"{% static 'clover12.jpg' %}","{% static 'clover13.jpg' %}","{% static 'clover1.jpg' %}"];
    var spade = ["{% static 'spade2.jpg' %}","{% static 'spade3.jpg' %}","{% static 'spade4.jpg' %}"
    ,"{% static 'spade5.jpg' %}","{% static 'spade6.jpg' %}","{% static 'spade7.jpg' %}","{% static 'spade8.jpg' %}"
    ,"{% static 'spade9.jpg' %}","{% static 'spade10.jpg' %}","{% static 'spade11.jpg' %}","{% static 'spade12.jpg' %}"
    ,"{% static 'spade13.jpg' %}","{% static 'spade1.jpg' %}"];
    var heart = ["{% static 'heart2.jpg' %}","{% static 'heart3.jpg' %}","{% static 'heart4.jpg' %}"
    ,"{% static 'heart5.jpg' %}","{% static 'heart6.jpg' %}","{% static 'heart7.jpg' %}","{% static 'heart8.jpg' %}"
    ,"{% static 'heart9.jpg' %}","{% static 'heart10.jpg' %}","{% static 'heart11.jpg' %}","{% static 'heart12.jpg' %}"
    ,"{% static 'heart13.jpg' %}","{% static 'heart1.jpg' %}"];
    var dia = ["{% static 'dia2.jpg' %}","{% static 'dia3.jpg' %}"
    ,"{% static 'dia4.jpg' %}","{% static 'dia5.jpg' %}","{% static 'dia6.jpg' %}","{% static 'dia7.jpg' %}"
    ,"{% static 'dia8.jpg' %}","{% static 'dia9.jpg' %}","{% static 'dia10.jpg' %}","{% static 'dia11.jpg' %}"
    ,"{% static 'dia12.jpg' %}","{% static 'dia13.jpg' %}","{% static 'dia1.jpg' %}"];
//関数の外に親カードと子カード用の変数を作成
    var oyacard;
    var kocard;
    var suit;
//スートを設定する関数
    function changeSuit(){
        switch(Math.floor( Math.random() * 4)){
            case 0:
                suit = clover;//配列は参照渡し(suitで変更したらcloverも変更)
                break;
            case 1:
                suit = spade;
                break;
            case 2:
                suit = heart;
                break;
            case 3:
                suit = dia;
                break;
        }
    }
//親カードを設定する関数(スートを設定したあとに呼び出す)
    function oya(){
        oyacard = Math.floor( Math.random() * suit.length);
    }
//子カードを設定する関数(親カードを設定したあとに呼び出す)
    function ko(){
        kocard = Math.floor( Math.random() * suit.length);
        while(kocard === oyacard){//親カードとダブったら選びなおす
            kocard = Math.floor( Math.random() * suit.length);
        }
    }
//裏面表示
    function changeBack(){
        document.getElementById("smallcard").src="{% static 'back.jpg' %}";
    }
//初期アクセス
    function firstFunc(){
        changeSuit();//スートを設定
        oya();//親カードを設定
        document.getElementById("bigcard").src=suit[oyacard];//親カードの書き換え
        ko();//子カードを設定(書き換えはめくるアニメーションで行う)
        changeBack();//子カードを裏面に
        changeDisplay1();//ハイアンドローボタンの非表示
        changeDisplay2();//続けるやめるボタンの非表示
        changeDisplay3();//ベットやめるボタンの非表示
        modal_original('on');
    }
//続けるボタンからのカードチェンジ
    function changeNext(){
        changeSuit();//スートを設定
        oya();//親カードを設定
        document.getElementById("bigcard").src=suit[oyacard];//親カードの書き換え
        ko();//子カードを設定(書き換えはめくるアニメーションで行う)
        changeBack();//子カードを裏面に
        changeDisplay1();//ハイアンドローボタンの表示
    }
//カードをめくるアニメーション
    const buttonElem1 = document.getElementById('high');
    const buttonElem2 = document.getElementById('low');
    let isBack = true;
    
    if(buttonElem1 !== null){
        buttonElem1.addEventListener('click', () => {
            const element = document.getElementById('smallcard');
            if(element !== null){
                let imagePath = isBack ? suit[kocard] : "{% static 'back.jpg' %}";
                rotationAnimationLoop(element, imagePath, 0);
                isBack = !isBack;
            }
        });
    }
    if(buttonElem2 !== null){
        buttonElem2.addEventListener('click', () => {
            const element = document.getElementById('smallcard');
            if(element !== null){
                let imagePath = isBack ? suit[kocard] : "{% static 'back.jpg' %}";
                rotationAnimationLoop(element, imagePath, 0);
                isBack = !isBack;
            }
        });
    }
    const rotationAnimationLoop = (element, imagePath, deg) =>{
        element.style.webkitTransform = 'rotateY(360deg)';
        if( deg <= 180 ){
            rotationAnimation(element, imagePath, deg);
            setTimeout( 
                () => {
                    rotationAnimationLoop(element, imagePath, deg+= 5 ) 
                }, 
            1 );
        }
    }
    const rotationAnimation = (element, imagePath, deg) =>{
        if ( 180 === deg ){
            element.src =  imagePath;//画像の切り替え
        }
        else {
            element.style.webkitTransform = 'rotateY(' + deg + 'deg)';//回転アニメーション
        }
    }
//続けるやめるボタンの処理
    const buttonElem3 = document.getElementById('stop');
    const buttonElem4 = document.getElementById('cont');
    if(buttonElem3 !== null){//続けるボタンを押したときの処理
        buttonElem3.addEventListener('click', () => {
            const element = document.getElementById('smallcard');
            if(element !== null){
                let imagePath = isBack ? suit[kocard] : "{% static 'back.jpg' %}";
                rotationAnimationLoop(element, imagePath, 0);
                isBack = !isBack;
            }
            contFunc();
        });
    }
    if(buttonElem4 !== null){//やめるボタンを押したときの処理
        buttonElem4.addEventListener('click', () => {
            const element = document.getElementById('smallcard');
            if(element !== null){
                let imagePath = isBack ? suit[kocard] : "{% static 'back.jpg' %}";
                rotationAnimationLoop(element, imagePath, 0);
                isBack = !isBack;
            }
            stopFunc();
        });
    }
//続けるボタンを押したあとの処理(ポイントが増えたり、カードが減ったり?)
    function contFunc(){
        changeNext();
    }
//やめるボタンを押したあとの処理(ポイントの獲得?)
    function stopFunc(){
        changeNext();
    }
//ハイアンドローボタンの処理
    const buttonElem5 = document.getElementById('high');
    const buttonElem6 = document.getElementById('low');
    if(buttonElem5 !== null){//ハイボタンを押したときの処理
        buttonElem5.addEventListener('click', () => {
            highFunc();
        });
    }
    if(buttonElem6 !== null){//ローボタンを押したときの処理
        buttonElem6.addEventListener('click', () => {
            lowFunc();
        });
    }
//ハイボタンを押したあとの処理
    function highFunc(){
      if(judg0() === "success"){
        setTimeout("changeDisplay2();",650);
      }
      else if(judg0() === "failure"){
        setTimeout("changeDisplay3();",650);
      }
    }
//ローボタンを押したあとの処理
    function lowFunc(){
      if(judg1() === "success"){
        setTimeout("changeDisplay2();",650);
      }
      else if(judg1() === "failure"){
        setTimeout("changeDisplay3();",650);
      }
    }
//ベットボタンの処理
    const buttonElem7 = document.getElementById('betcoin');
    const buttonElem8 = document.getElementById('betbtn');
    if(buttonElem8 !== null){//ベットボタンを押したときの処理
        buttonElem8.addEventListener('click', () => {
            if(buttonElem7.style.visibility == "hidden"){
                buttonElem7.style.visibility = "visible";
                buttonElem8.style.visibility = "visible";
            }else{
                buttonElem7.style.visibility = "hidden";
                buttonElem8.style.visibility = "hidden";
            }
            changeDisplay1();
            modal_original("");
        });
    }
//表示非表示
    function changeDisplay1(){//ハイアンドローボタン
      var high = document.getElementById("high");
      var low = document.getElementById("low");
      if(high.style.visibility == "hidden"){
        high.style.visibility = "visible";
        low.style.visibility = "visible";
      }else{
        high.style.visibility = "hidden";
        low.style.visibility = "hidden";
      }
    }
    function changeDisplay2(){//続けるやめるボタン
      var stop = document.getElementById("stop");
      var cont = document.getElementById("cont");
      if(stop.style.display == "none"){
        stop.style.display = "block";
        cont.style.display = "block";
      }else{
        stop.style.display = "none";
        cont.style.display = "none";
      }
    }
    function changeDisplay3(){//ベットやめるボタン
      var bet = document.getElementById("bet");
      var top = document.getElementById("top");
      if(bet.style.display == "none"){
        bet.style.display = "block";
        top.style.display = "block";
      }else{
        bet.style.display = "none";
        top.style.display = "none";
      }
    }
//成功失敗の判定
    function judg0(){
        if(kocard >= oyacard){
            return "success";
        }
        else if(kocard < oyacard){
            return "failure";
        }
    }
    function judg1(){
        if(kocard <= oyacard){
            return "success";
        }
        else if(kocard > oyacard){
            return "failure";
        }
    }


function modal_original(modalswitch){

    const setting_modalid = 'modaloverlay_id';
    //モーダルのIDを指定

    var smodalobj = document.getElementById(setting_modalid);

    //引数がonの場合は表示する
    if(modalswitch=='on'){
        document.getElementById(setting_modalid).style.display = 'block';
    }
    else{
        document.getElementById(setting_modalid).style.display = 'none';
    }

    //イベントを定義
    smodalobj.addEventListener('click',overlayclick, false);

//モーダルをクリックしたら起動し、不要な要素を非表示に
    function overlayclick(){
        document.getElementById(setting_modalid).style.display = 'none';
    }

}
</script>