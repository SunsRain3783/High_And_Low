{% load static %}
<!doctype HTML>
<html>
    <head>
        <link rel="stylesheet" href="{% static '1p.css' %}">
    </head>
    <body onload="firstFunc();"><!--ここから中身-->
    <!--ヘッダー-->
    <div class="header">
        <a href="/" class="btn-flat-vertical-border">トップページ</a>
        <a href="#" class="btn-flat-vertical-border3" style="left:20%;">ログイン</a>
        <img src="{% static 'aicon.png' %}" class="aicon"/>
        <b class="name">　ゲスト　</b><!--名前は5文字以内？-->
        <a href="/how" class="btn-flat-vertical-border2" style="left:37%;">遊び方</a>
    </div>
    <!--画像-->
    <div id="main" >
    <div class="content">
      <img src="{% static 'HighAndLow_title.jpg' %}" class="img1" id="image" />
    </div>
    <!--トランプの画像-->
    <div>
        <img src="" width="270" class="bigcard" id="bigcard" />
    </div>
    <div>
        <img src="" width="260" class="smallcard" id="smallcard" />
    </div>
    
    <!--ハイアンドローボタン-->
    <div class="highbtn">
        <a href="#" class="btn" id="low" onclick="lowFunc();" >▼ LOW ▼</a>
        <a href="#" class="btn2" id="high" onclick="highFunc();" >▲ HIGH ▲</a>
    </div>
    
    <!--続けるやめるボタン-->
    <div class="stopcont">
        <font size="20"><a href="#" class="bt-stop" id="stop" onclick="contFunc();" >続ける</a></font>
        <font size="20"><a href="#" class="bt-cont" id="cont" onclick="stopFunc();" >やめる</a></font>
    </div>
    <!--ベットやめるボタン-->
    <!--<div class="bettop">
        <font size="10"><a href="#" class="btn-circle-border-double" id="bet" onclick="changeDisplay3();" >ベット</a></font>
        <font size="10"><a href="/" class="btn-circle-border-double2" id="top" >トップ</a></font>
    </div>-->
    
    <!--ベットボタン(OK)-->
    <div class="pickupblock">
        <img src="{% static 'betcoin.jpg' %}" width="1200" class="betcoin" id="betcoin" />
        <a href="#" class="btn-icon" id="betbtn" onclick="betOK();" >OK </a>
    </div>
    
    <!--ベットボタン(BETする)-->
    <div class="container">
        <a href="#" class="btn-denim2" id="shop" onclick="shop();" >ショップ</a>
        <a href="#" class="btn-denim" id="bet_suru" onclick="betsuru();" >BETする</a>
        <a href="#" class="btn-denim3" id="achieve" onclick="achieve();" >実績</a>
    </div>

    <!-- モーダル部分 -->
    <div class="modaloverlay" id="modaloverlay_id">
    </div>
    
    <!--所持ポイント-->
    <table>
    <tr>
        <div><img src="{% static 'syoji.png' %}" class="syoji1" id="syoji1" /></div>
    <!--獲得ポイント-->
        <div><img src="{% static 'get.png' %}" class="get1" id="get1" /></div>
    </tr></table>
    
    <!--所持ポイント-->
    <table>
    <tr>
        <div><img src="{% static 'syoji.png' %}" class="syoji2" id="syoji2" /></div>
    <!--獲得ポイント-->
        <div><img src="{% static 'get.png' %}" class="get2" id="get2" /></div>
    </tr></table>
    
    <!--所持ポイント-->
    <table>
    <tr>
        <div><img src="{% static 'syoji.png' %}" class="syoji3" id="syoji3" /></div>
    <!--獲得ポイント-->
        <div><img src="{% static 'get.png' %}" class="get3" id="get3" /></div>
    </tr></table>

    <!--強さの画像-->
    <img src="{% static 'tsuyoi.png' %}" class="tsuyosa" id="tsuyosa" />
    <!--強さの画像-->
    <img src="{% static 'tsuyoi.png' %}" class="tsuyosa2" id="tsuyosa2" />
    
    <!--ポイント-->
    <p class="pt1" id="pt1"></p>
    <p class="gpt1" id="gpt1"></p>
    
    <p class="pt2" id="pt2"></p>
    <p class="gpt2" id="gpt2"></p>
    
    <p class="pt3" id="pt3"></p>
    <p class="gpt3" id="gpt3"></p>
    </div>
    
    <!--ショップ-->
    <div id="sp" >
        <table>
            <tr>
            <div><p align="left" class="sample-box-1" ><font size=5px>「スキップシューズ」　１度だけ親のカードを変えることができる</font></p>
            <img src="{% static 'スキップシューズ.png' %}" class="skip"/>
            <a href="#" class="btn-gradient-3d-simple1" id="skip" onclick="skipFunc();"><font size="5px">BUTTON</font></a></div>
            <div><p align="left" class="sample-box-2" ><font size=5px>「フリップグローブ」　１度だけ子のカードをめくることができる</font></p>
            <img src="{% static 'フリップグローブ.png' %}" class="flip"/>
            <a href="#" class="btn-gradient-3d-simple2" id="flip" onclick="flipFunc();"><font size="5px">BUTTON</font></a></div>
            <div><p align="left" class="sample-box-3" ><font size=5px>「ハイヤースイッチ」　１度だけ子のカードの出目を9,10,11,12,13,1のいずれかにする</font></p>
            <img src="{% static 'ハイヤースイッチ.png' %}" class="higher"/>
            <a href="#" class="btn-gradient-3d-simple3" id="higher" onclick="higherFunc();"><font size="5px">BUTTON</font></a></div>
            <div><p align="left" class="sample-box-4" ><font size=5px>「ロワースイッチ」　　１度だけ子のカードの出目を2,3,4,5,6,7のいずれかにする</font></p>
            <img src="{% static 'ロワースイッチ.png' %}" class="lower"/>
            <a href="#" class="btn-gradient-3d-simple4" id="lower" onclick="lowerFunc();"><font size="5px">BUTTON</font></a></div>
            <div><p align="left" class="sample-box-5" ><font size=5px>「報酬倍率３倍」　　　報酬倍率が常に３倍になる</font></p>
            <img src="{% static '倍率アップ.png' %}" class="up"/>
            <a href="#" class="btn-gradient-3d-simple5" id="up" onclick="upFunc();"><font size="5px">BUTTON</font></a></div>
            <div><a href="#" class="btn-real" onclick="backhome();">戻</a></div></tr>
        </table>
    </div>
    
    </body>
</html>

<script>
//カードの配列(あえて１を最後にしている)
    var clover = ["{% static 'clover2.jpg' %}","{% static 'clover3.jpg' %}"
    ,"{% static 'clover4.jpg' %}","{% static 'clover5.jpg' %}","{% static 'clover6.jpg' %}","{% static 'clover7.jpg' %}"
    ,"{% static 'clover8.jpg' %}","{% static 'clover9.jpg' %}","{% static 'clover10.jpg' %}","{% static 'clover11.jpg' %}"
    ,"{% static 'clover12.jpg' %}","{% static 'clover13.jpg' %}","{% static 'clover1.jpg' %}"];
    var spade = ["{% static 'spade2.jpg' %}","{% static 'spade3.jpg' %}","{% static 'spade4.jpg' %}"
    ,"{% static 'spade5.jpg' %}","{% static 'spade6.jpg' %}","{% static 'spade7.jpg' %}","{% static 'spade8.jpg' %}"
    ,"{% static 'spade9.jpg' %}","{% static 'spade10.jpg' %}","{% static 'spade11.jpg' %}","{% static 'spade12.jpg' %}"
    ,"{% static 'spade13.jpg' %}","{% static 'spade1.jpg' %}"];
    var heart = ["{% static 'heart2.jpg' %}","{% static 'heart3.jpg' %}","{% static 'heart4.jpg' %}"
    ,"{% static 'heart5.jpg' %}","{% static 'heart6.jpg' %}","{% static 'heart7.jpg' %}","{% static 'heart8.jpg' %}"
    ,"{% static 'heart9.jpg' %}","{% static 'heart10.jpg' %}","{% static 'heart11.jpg' %}","{% static 'heart12.jpg' %}"
    ,"{% static 'heart13.jpg' %}","{% static 'heart1.jpg' %}"];
    var dia = ["{% static 'dia2.jpg' %}","{% static 'dia3.jpg' %}"
    ,"{% static 'dia4.jpg' %}","{% static 'dia5.jpg' %}","{% static 'dia6.jpg' %}","{% static 'dia7.jpg' %}"
    ,"{% static 'dia8.jpg' %}","{% static 'dia9.jpg' %}","{% static 'dia10.jpg' %}","{% static 'dia11.jpg' %}"
    ,"{% static 'dia12.jpg' %}","{% static 'dia13.jpg' %}","{% static 'dia1.jpg' %}"];
//関数の外に親カードと子カード用の変数を作成
    var oyacard;
    var kocard;
    var suit;
//スートを設定する関数
    function changeSuit(){
        switch(Math.floor( Math.random() * 4)){
            case 0:
                suit = clover;//配列は参照渡し(suitで変更したらcloverも変更)
                break;
            case 1:
                suit = spade;
                break;
            case 2:
                suit = heart;
                break;
            case 3:
                suit = dia;
                break;
        }
    }
//親カードを設定する関数(スートを設定したあとに呼び出す)
    function oya(){
        oyacard = Math.floor( Math.random() * suit.length);
    }
//子カードを設定する関数(親カードを設定したあとに呼び出す)
    function ko(){
        kocard = Math.floor( Math.random() * suit.length);
        while(kocard === oyacard){//親カードとダブったら選びなおす
            kocard = Math.floor( Math.random() * suit.length);
        }
    }
//裏面表示
    function changeBack(){
        document.getElementById("smallcard").src="{% static 'back.jpg' %}";
    }
//初期アクセス
    function firstFunc(){
        changeSuit();//スートを設定
        oya();//親カードを設定
        document.getElementById("bigcard").src=suit[oyacard];//親カードの書き換え
        ko();//子カードを設定(書き換えはめくるアニメーションで行う)
        changeBack();//子カードを裏面に
        changeDisplay1();//ハイアンドローボタンの非表示
        changeDisplay2();//続けるやめるボタンの非表示
        //changeDisplay3();//ベットやめるボタンの非表示
        changeDisplay4();//ベット画像とOKの非表示
        changeDisplay6();//カード非表示
        syojiget2();//所持、獲得ポイント２の非表示
        syojiget3();//所持、獲得ポイント３の非表示
        tsuyosa1();//強さ画像１の非表示
        tsuyosa2();//強さ画像２の非表示
        pointText();//ポイントを設置
        shopbtn();//ショップの非表示
        //modal_original('on');
    }
//カードチェンジ
    function changeNext(){
        changeSuit();//スートを設定
        oya();//親カードを設定
        document.getElementById("bigcard").src=suit[oyacard];//親カードの書き換え
        ko();//子カードを設定(書き換えはめくるアニメーションで行う)
        changeBack();//子カードを裏面に
    }
//カードをめくるアニメーション
    const buttonElem1 = document.getElementById('high');
    const buttonElem2 = document.getElementById('low');
    let isBack = true;
    
    if(buttonElem1 !== null){
        buttonElem1.addEventListener('click', () => {
            const element = document.getElementById('smallcard');
            if(element !== null){
                let imagePath = isBack ? suit[kocard] : "{% static 'back.jpg' %}";
                rotationAnimationLoop(element, imagePath, 0);
                isBack = !isBack;
            }
        });
    }
    if(buttonElem2 !== null){
        buttonElem2.addEventListener('click', () => {
            const element = document.getElementById('smallcard');
            if(element !== null){
                let imagePath = isBack ? suit[kocard] : "{% static 'back.jpg' %}";
                rotationAnimationLoop(element, imagePath, 0);
                isBack = !isBack;
            }
        });
    }
    const rotationAnimationLoop = (element, imagePath, deg) =>{
        element.style.webkitTransform = 'rotateY(360deg)';
        if( deg <= 180 ){
            rotationAnimation(element, imagePath, deg);
            setTimeout( 
                () => {
                    rotationAnimationLoop(element, imagePath, deg+= 5 ) 
                }, 
            1 );
        }
    }
    const rotationAnimation = (element, imagePath, deg) =>{
        if ( 180 === deg ){
            element.src =  imagePath;//画像の切り替え
        }
        else {
            element.style.webkitTransform = 'rotateY(' + deg + 'deg)';//回転アニメーション
        }
    }
//カードをめくる関数
    function mekuru(){
        const element = document.getElementById('smallcard');
        if(element !== null){
            let imagePath = isBack ? suit[kocard] : "{% static 'back.jpg' %}";
            rotationAnimationLoop(element, imagePath, 0);
            isBack = !isBack;
        }
    }

//続けるボタンを押したあとの処理(ポイントが増えたり、カードが減ったり?)
    function contFunc(){
        changeDisplay2();
        mekuru();
        changeNext();
        changeDisplay1();
        tsuyosa2();//消える
        tsuyosa1();//見える
        syojiget3();//消える
        syojiget2();//見える
    }
//やめるボタンを押したあとの処理(ポイントの獲得?)
    function stopFunc(){
        //ポイント獲得のメッセージ
        changeDisplay2();
        mekuru();
        changeNext();
        changeDisplay5();
        changeDisplay6();
        changeDisplay7();
        tsuyosa2();//消える
        syojiget3();//消える
        syojiget1();//見える
        getP();
        loseP();
    }
//ハイボタンを押したあとの処理
    function highFunc(){
      changeDisplay1();
      if(judg0() === "success"){
        setTimeout("win();",650);
      }
      else if(judg0() === "failure"){
        setTimeout("lose();",650);
      }
    }
//ローボタンを押したあとの処理
    function lowFunc(){
      changeDisplay1();
      if(judg1() === "success"){
        setTimeout("win();",650);
      }
      else if(judg1() === "failure"){
        setTimeout("lose();",650);
      }
    }
//成功したあとの処理
    function win(){
        //WIN画像
        changeDisplay2();//続けるやめるボタンがでてくる
        tsuyosa1();//消える
        tsuyosa2();//見える
        syojiget2();//消える
        syojiget3();//見える
        reward();
    }
//失敗したあとの処理
    function lose(){
        //LOSE画像
        setTimeout("lose2();", 1000);
        setTimeout("get1000P();",1001);
    }
    function lose2(){
        mekuru();
        changeNext();
        changeDisplay5();
        changeDisplay6();
        changeDisplay7();
        tsuyosa1();
        syojiget2();
        syojiget1();
        loseP();
    }
    function get1000P(){
        if(nowpoint === 0){
            nowpoint = 1000;
            alert("ポイントが0になったため1000ポイント付与しました");
            pointText();
        }
    }
//ベットするボタンを押したあとの処理
    function betsuru(){
        changeDisplay5();
        changeDisplay4();
        modal_original('on');
    }
//表示非表示
    function changeDisplay1(){//ハイアンドローボタン
      var high = document.getElementById("high");
      var low = document.getElementById("low");
      if(high.style.visibility == "hidden"){
        high.style.visibility = "visible";
        low.style.visibility = "visible";
      }else{
        high.style.visibility = "hidden";
        low.style.visibility = "hidden";
      }
    }
    function changeDisplay2(){//続けるやめるボタン
      var stop = document.getElementById("stop");
      var cont = document.getElementById("cont");
      if(stop.style.display == "none"){
        stop.style.display = "block";
        cont.style.display = "block";
      }else{
        stop.style.display = "none";
        cont.style.display = "none";
      }
    }
//    function changeDisplay3(){//ベットやめるボタン
//      var bet = document.getElementById("bet");
//      var top = document.getElementById("top");
//      if(bet.style.display == "none"){
//        bet.style.display = "block";
//        top.style.display = "block";
//      }else{
//        bet.style.display = "none";
//        top.style.display = "none";
//      }
//    }
    function changeDisplay4(){//ベット画像とOK
        var betCoin = document.getElementById('betcoin');
        var betBtn = document.getElementById('betbtn');
        if(betCoin.style.visibility == "hidden"){
            betCoin.style.visibility = "visible";
            betBtn.style.visibility = "visible";
        }else{
            betCoin.style.visibility = "hidden";
            betBtn.style.visibility = "hidden";
        }        
    }
    function changeDisplay5(){//ベットするボタン
        var betSuru = document.getElementById('bet_suru');
        var shop = document.getElementById('shop');
        var achieve = document.getElementById('achieve');
        if(betSuru.style.display == "none"){
            betSuru.style.display = "block";
            shop.style.display = "block";
            achieve.style.display = "block";
        }else{
            betSuru.style.display = "none";
            shop.style.display = "none";
            achieve.style.display = "none";
        }
    }
    function changeDisplay6(){//親カード子カード
      var big = document.getElementById("bigcard");
      var small = document.getElementById("smallcard");
      if(big.style.display == "none"){
        big.style.display = "block";
        small.style.display = "block";
      }else{
        big.style.display = "none";
        small.style.display = "none";
      }
    }
    function changeDisplay7(){//画像
      var image = document.getElementById("image");
      if(image.style.display == "none"){
        image.style.display = "block";
      }else{
        image.style.display = "none";
      }
    }
    function tsuyosa1(){//強さ画像
      var t = document.getElementById("tsuyosa");
      if(t.style.display == "none"){
        t.style.display = "block";
      }else{
        t.style.display = "none";
      }
    }
    function tsuyosa2(){//強さ画像
      var ts = document.getElementById("tsuyosa2");
      if(ts.style.display == "none"){
        ts.style.display = "block";
      }else{
        ts.style.display = "none";
      }
    }
    function syojiget1(){
      var s = document.getElementById("syoji1");
      var g = document.getElementById("get1");
      var ppp1 = document.getElementById("pt1");
      var ggg1 = document.getElementById("gpt1");
      if(s.style.display == "none"){
        s.style.display = "block";
        g.style.display = "block";
        ppp1.style.display = "block";
        ggg1.style.display = "block";
      }else{
        s.style.display = "none";
        g.style.display = "none";
        ppp1.style.display = "none";
        ggg1.style.display = "none";
      }
    }
    function syojiget2(){
      var sy = document.getElementById("syoji2");
      var ge = document.getElementById("get2");
      var ppp2 = document.getElementById("pt2");
      var ggg2 = document.getElementById("gpt2");
      if(sy.style.display == "none"){
        sy.style.display = "block";
        ge.style.display = "block";
        ppp2.style.display = "block";
        ggg2.style.display = "block";
      }else{
        sy.style.display = "none";
        ge.style.display = "none";
        ppp2.style.display = "none";
        ggg2.style.display = "none";
      }
    }
    function syojiget3(){
      var syy = document.getElementById("syoji3");
      var gee = document.getElementById("get3");
      var ppp3 = document.getElementById("pt3");
      var ggg3 = document.getElementById("gpt3");
      if(syy.style.display == "none"){
        syy.style.display = "block";
        gee.style.display = "block";
        ppp3.style.display = "block";
        ggg3.style.display = "block";
      }else{
        syy.style.display = "none";
        gee.style.display = "none";
        ppp3.style.display = "none";
        ggg3.style.display = "none";
      }
    }
//ベットボタン(OK)を押したあとの処理
    function betOK(){
        changeDisplay4();
        changeDisplay1();
        changeDisplay6();
        changeDisplay7();
        tsuyosa1();//見える
        syojiget1();//消える
        syojiget2();//見える
        modal_original("");
        betP();
        get100();
    }
//成功失敗の判定
    function judg0(){
        if(kocard >= oyacard){
            return "success";
        }
        else if(kocard < oyacard){
            return "failure";
        }
    }
    function judg1(){
        if(kocard <= oyacard){
            return "success";
        }
        else if(kocard > oyacard){
            return "failure";
        }
    }


function modal_original(modalswitch){

    const setting_modalid = 'modaloverlay_id';
    //モーダルのIDを指定

    var smodalobj = document.getElementById(setting_modalid);

    //引数がonの場合は表示する
    if(modalswitch=='on'){
        document.getElementById(setting_modalid).style.display = 'block';
    }
    else{
        document.getElementById(setting_modalid).style.display = 'none';
    }

    //イベントを定義
    smodalobj.addEventListener('click',overlayclick, false);

//モーダルをクリックしたら起動し、不要な要素を非表示に
    function overlayclick(){
        document.getElementById(setting_modalid).style.display = 'none';
    }

}
//初期ポイント
var nowpoint = 1000;
var getpoint = 0;
//ポイントの処理
    function get100(){
        getpoint = 100;
        pointText();
    }
    function reward(){
        getpoint += getpoint;//報酬倍率２倍
        pointText();
    }
    function betP(){
        nowpoint -= 100;
        pointText();
    }
    function getP(){
        nowpoint += getpoint;//ポイント獲得
        pointText();
    }
    function loseP(){
        getpoint = 0;//ポイント０
        pointText();
    }
    function pointText(){
        document.getElementById("pt1").textContent = nowpoint;
        document.getElementById("gpt1").textContent = getpoint;
        document.getElementById("pt2").textContent = nowpoint;
        document.getElementById("gpt2").textContent = getpoint;
        document.getElementById("pt3").textContent = nowpoint;
        document.getElementById("gpt3").textContent = getpoint;
    }

//メイン要素非表示
    function main(){
      var ma = document.getElementById("main");
      if(ma.style.display == "none"){
        ma.style.display = "block";
      }else{
        ma.style.display = "none";
      }
    }
//ショップ非表示
    function shopbtn(){
      var sh = document.getElementById("sp");
      if(sh.style.display == "none"){
        sh.style.display = "block";
      }else{
        sh.style.display = "none";
      }
    }

//ショップボタンの処理
    function shop(){
        main();
        shopbtn();
        varueText();
    }

//戻るボタンの処理
    function backhome(){
        shopbtn();
        main();
    }
//アイテム購入の処理
var sct = 0;
var fct = 0;
var hct = 0;
var lct = 0;
var uct = 0;
var skip = "5,000P (0/10)";
var flip = "20,000P (0/10)";
var higher = "10,000P (0/5)";
var lower = "10,000P (0/5)";
var up = "  1,000,000P  ";
    function skipFunc(){
        if(sct < 10 && nowpoint-5000 > 0){
            nowpoint -= 5000;
            pointText();
            sct += 1;
            skip = "5,000P (" + sct + "/10)"
            varueText();
        }
    }
    function flipFunc(){
        if(fct < 10 && nowpoint-20000 > 0){
            nowpoint -= 20000;
            pointText();
            fct += 1;
            flip = "20,000P (" + fct + "/10)"
            varueText();
        }
    }
    function higherFunc(){
        if(hct < 5 && nowpoint-10000 > 0){
            nowpoint -= 10000;
            pointText();
            hct += 1;
            higher = "10,000P (" + hct + "/5)"
            varueText();
        }
    }
    function lowerFunc(){
        if(lct < 5 && nowpoint-10000 > 0){
            nowpoint -= 10000;
            pointText();
            lct += 1;
            lower = "10,000P (" + lct + "/5)"
            varueText();
        }
    }
    function upFunc(){
        if(uct < 1 && nowpoint-1000000 > 0){
            nowpoint -= 1000000;
            pointText();
            uct += 1;
            up = "購入済み"
            varueText();
        }
    }
    function varueText(){
        document.getElementById("skip").textContent = skip;
        document.getElementById("flip").textContent = flip;
        document.getElementById("higher").textContent = higher;
        document.getElementById("lower").textContent = lower;
        document.getElementById("up").textContent = up;
    }



</script>